plugins {
  id 'org.springframework.boot' version '2.7.4'
  id 'io.spring.dependency-management' version '1.0.14.RELEASE'
  id 'org.unbroken-dome.test-sets' version '4.0.0'
  id 'maven-publish'
  id "org.flywaydb.flyway" version "9.2.0"
}

allprojects {

  repositories {
    mavenLocal()
    mavenCentral()
    maven {
      url = uri('https://repo.maven.apache.org/maven2/')
    }
  }

  apply plugin: 'java'
  apply plugin: 'groovy'
  apply plugin: 'org.springframework.boot'
  apply plugin: 'io.spring.dependency-management'

  dependencies {
    compileOnly 'org.projectlombok:lombok:1.18.24'
    annotationProcessor "org.springframework.boot:spring-boot-configuration-processor"
    annotationProcessor 'org.projectlombok:lombok:1.18.24'

    testCompileOnly 'org.projectlombok:lombok:1.18.24'
    testAnnotationProcessor 'org.projectlombok:lombok:1.18.24'

    testImplementation(group: 'org.codehaus.groovy', name: 'groovy-all', version: '3.0.9')
    testImplementation(group: 'org.spockframework', name: 'spock-core', version: '2.0-groovy-3.0')
    testImplementation(group: 'org.spockframework', name: 'spock-spring', version: '2.1-M2-groovy-3.0')

  }
}

apply from: "${rootDir}/gradle/test.gradle"

dependencies {
  implementation project(":my-web-service-api")
  implementation project(":email-sender-service")
  implementation(group: 'ch.qos.logback', name: 'logback-core', version: '1.2.10')

  implementation(group: 'org.springframework.boot', name: 'spring-boot-starter-web')
  implementation(group: 'org.springframework.boot', name: 'spring-boot-starter-data-jpa')
  implementation(group: 'org.springframework.boot', name: 'spring-boot-starter-security')

  implementation(group: 'org.postgresql', name: 'postgresql', version: '42.2.26')
  implementation(group: 'javax.xml.bind', name: 'jaxb-api', version: '2.3.1')
  implementation(group: 'io.jsonwebtoken', name: 'jjwt', version: '0.6.0')

  implementation(group: 'org.modelmapper', name: 'modelmapper', version: '3.0.0')
  implementation(group: 'org.codehaus.jackson', name: 'jackson-mapper-asl', version: '1.9.13')

  implementation 'org.springframework.boot:spring-boot-starter-thymeleaf'

  testImplementation(group: 'org.springframework.boot', name: 'spring-boot-starter-test')

  testImplementation(group: 'org.testcontainers', name: 'postgresql', version: '1.17.3')
  testImplementation "org.testcontainers:spock:1.17.3"


}

project(":email-sender-service") {
  dependencies {
    implementation(group: 'org.springframework.boot', name: 'spring-boot-starter-web')
    implementation(group: 'org.springframework.boot', name: 'spring-boot-starter-mail')
    implementation(group: 'org.freemarker', name: 'freemarker', version: '2.3.31')

  }
}

group = 'pl.tchorzyksen'
version = '0.1.1-SNAPSHOT'
description = 'my-web-service'
java.sourceCompatibility = JavaVersion.VERSION_17

publishing {
  publications {
    maven(MavenPublication) {
      from(components.java)
    }
  }
}

tasks.withType(JavaCompile) {
  options.encoding = 'UTF-8'
}

flyway {
  url = 'jdbc:postgresql://localhost:5432/scratchpad'
  user = 'scratchpad'
  password = 'scratchpad'
  schemas = ['scratchpad']
  locations = ['filesystem:src/main/resources/db/migration']
  cleanDisabled = false
}
